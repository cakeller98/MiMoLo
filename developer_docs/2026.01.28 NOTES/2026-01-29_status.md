# 2026-01-29 Work Note

## What we decided
- Agents communicate with orchestrator over Agent JLP (stdin/stdout JSON lines).
- AF_UNIX IPC is reserved for dashboard <-> orchestrator (and report/exporters).
- Storage is JSONL daily journals; no SQLite for now.
- Per-user data folder is the root for all artifacts:
  - Windows: %AppData%\mimolo
  - macOS: ~/Library/Application Support/mimolo
  - Linux: ~/.local/share/mimolo
- Agent artifacts live in: <base>/<agent_name>/...
- Dashboard artifacts live in: <base>/dashboard/...

## Agent specs created
Under developer_docs/agent_dev/<agent_name>/:
- trail_tracker_SPEC.md
- blender_sonar_SPEC.md
- client_folder_activity_SPEC.md
- screen_tracker_SPEC.md

These now include artifact storage rules per platform.

## Architecture direction
- Monorepo for now. Electron deferred.
- Current module layout target (in-repo):
  - orchestrator (python)
  - agents/*
  - reporter_exporters/*
  - dashboard (TS IPC prototype only)
  - common (shared schemas/protocols)
- Later: mimolo-dash sibling repo for Electron UI.

## IPC prototype (TypeScript)
Created minimal TS IPC harness in mimolo/dashboard/:
- src/index.ts connects to AF_UNIX socket via MIMOLO_IPC_PATH and sends a placeholder command.
- package.json + tsconfig.json + README.md are set up.

## Install & registry plan (agreed)
- Agents are installed to per-user folder, not run from source module.
- Install = unzip into %AppData%/mimolo/agents/<plugin_id>/ (platform equivalents).
- Orchestrator scans install folder to list available plugins.
- Installed plugins != running instances (instances are separate config/task list).

Dashboard commands (planned):
- dash list-plugs
- dash install <zip> (no overwrite)
- dash upgrade <zip> (only if newer)
- dash install --force <zip> (overwrite)

## Plugin manifest (minimal)
- manifest.json outside payload files; contains version + required params.
- Payload hash manifest (payload_hashes.json) included in zip but not itself hashed.

## Integrity model (agreed)
- Use SHA-256 for file hashes.
- Orchestrator stores a signed copy of payload hashes using a local secret key (HMAC-SHA256).
- Validation compares current file hashes vs payload_hashes.json AND verifies HMAC signature.
- Prevents tampering even if someone edits payload_hashes.json on disk.

## Recent run notes
See developer_docs/2026.01.28 NOTES/ for start_monitor.ps1 output.
Logs show UTC timestamps (filenames 2026-01-29xx.mimolo.jsonl).

## Next actions (when back)
0) Clarify IPC naming: IPC umbrella vs AF_UNIX IPC vs Agent JLP; update docs accordingly.
1) Implement install folder + manifest schema + registry format + scan.
2) Add IPC server in orchestrator to reply to list-plugs, install, upgrade.
3) Wire TS dashboard harness to actual IPC responses.
4) Define instance config model separate from install list.

## Codex environment note
- In the Codex sandbox, Python `py_compile` cannot write `__pycache__` in-repo (permission denied).
- Workaround for syntax checks: set `PYTHONPYCACHEPREFIX=$env:TEMP` (or run with no bytecode in temp).

